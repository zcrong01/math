<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <title>ì‹ ê¸°í•œ ìœ ë¦¬ìˆ˜ ë‚˜ë¬´: Calkinâ€“Wilf / Sternâ€“Brocot íŠ¸ë¦¬ ì‹œê°í™” (AIêµìœ¡ì—°êµ¬íšŒ : ìœ„ë“œì„)</title>
  <meta name="description" content="ëª¨ë“  ìœ ë¦¬ìˆ˜ê°€ ë”± í•œ ë²ˆì”©ë§Œ ë‚˜íƒ€ë‚˜ëŠ” ì‹ ê¸°í•œ ë‚˜ë¬´ë¥¼ íƒí—˜í•˜ë©°, ìì—°ìˆ˜ì™€ ìœ ë¦¬ìˆ˜ì˜ ì¼ëŒ€ì¼ ëŒ€ì‘(ê°€ì‚°ì„±)ì„ ì²´í—˜í•©ë‹ˆë‹¤." />

  <style>
    :root {
      --font-sans: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      
      /* Light Mode Colors */
      --bg: #f8f9fa;
      --bg-card: #ffffff;
      --ink: #212529;
      --ink-muted: #6c757d;
      --border: #dee2e6;
      --brand: #4c6ef5;
      --brand-light: #edf2ff;
      --brand-dark: #364fc7;
      --highlight-bg: #fff0f6;
      --highlight-stroke: #f06595;
      
      /* Sizing */
      --maxw: 1280px;
      --pad: clamp(16px, 2.2vw, 24px);
      --gap: clamp(12px, 1.8vw, 20px);
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgba(0,0,0,.07), 0 2px 4px -2px rgba(0,0,0,.05);
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #121212;
        --bg-card: #1e1e1e;
        --ink: #e9ecef;
        --ink-muted: #adb5bd;
        --border: #495057;
        --brand: #748ffc;
        --brand-light: #232946;
        --brand-dark: #91a7ff;
        --highlight-bg: #381a28;
        --highlight-stroke: #ff87ab;
      }
    }

    * { box-sizing: border-box; }
    html { font-size: 16px; scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: var(--font-sans);
      color: var(--ink);
      background-color: var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .wrap {
      max-width: var(--maxw);
      margin: 0 auto;
      padding: var(--gap);
    }
    h1, h2, h3 { margin: 0 0 8px; font-weight: 700; }
    h2 { font-size: 1.25rem; }
    p { margin: 0; line-height: 1.65; }

    .bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 1rem var(--pad);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background-color: var(--bg-card);
      box-shadow: var(--shadow);
    }
    .brand { font-size: 1.1rem; font-weight: 700; letter-spacing: -.2px; }
    .brand small { color: var(--ink-muted); font-weight: 500; margin-left: 8px; font-size: 0.9rem; }

    .card {
      background-color: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: var(--pad);
      box-shadow: var(--shadow);
    }
    .ctrls {
      display: grid;
      gap: var(--gap);
      grid-template-columns: 1fr;
      margin-top: var(--gap);
    }
    @media (min-width: 980px) {
      .ctrls { grid-template-columns: repeat(12, 1fr); }
      .ctrls > .g1 { grid-column: span 7; }
      .ctrls > .g2 { grid-column: span 5; }
    }
    .ctrls-group {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
    }

    label.inline { display: inline-flex; align-items: center; gap: 8px; font-size: 0.95rem; }
    input[type="radio"] { accent-color: var(--brand); }
    select, input[type="number"], input[type="text"] {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      min-width: 80px;
      background-color: var(--bg-card);
      color: var(--ink);
      font-size: 0.95rem;
      transition: border-color .2s, box-shadow .2s;
    }
    select:focus, input:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px var(--brand-light);
    }
    button.btn {
      padding: 9px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      background-color: var(--bg-card);
      color: var(--ink);
      font-weight: 600;
      font-size: 0.95rem;
      transition: background-color .2s, transform .1s, border-color .2s, color .2s;
    }
    button.btn:hover { background-color: var(--brand-light); border-color: var(--brand); color: var(--brand-dark); }
    button.btn:active { transform: translateY(1px); }
    button.primary { background-color: var(--brand); color: white; border-color: var(--brand); }
    button.primary:hover { background-color: var(--brand-dark); border-color: var(--brand-dark); color: white; }

    .host {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      background-color: var(--bg-card);
      box-shadow: var(--shadow);
      height: clamp(450px, 65vh, 720px);
      margin-top: var(--gap);
    }
    .panel {
      display: grid;
      gap: var(--gap);
      grid-template-columns: 1fr;
      margin-top: var(--gap);
    }
    @media (min-width: 1024px) {
      .panel { grid-template-columns: repeat(2, 1fr); }
      .panel .card.full { grid-column: 1 / -1; }
    }
    .muted { color: var(--ink-muted); }
    .hint { font-size: 0.85rem; color: var(--ink-muted); }
    .kbd { padding: 2px 8px; border: 1px solid var(--border); border-radius: 6px; background-color: var(--bg); font-family: monospace; font-size: 0.85rem; }
    
    .tbl { width: 100%; border-collapse: collapse; font-variant-numeric: tabular-nums; }
    .tbl th, .tbl td { border-bottom: 1px solid var(--border); padding: 10px 8px; text-align: left; }
    .tbl th { background-color: var(--bg); position: sticky; top: 0; z-index: 1; font-weight: 600; font-size: 0.9rem; }
    .tbl tbody tr:nth-child(even) { background-color: var(--bg); }
    .scroll { max-height: 280px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; }
    
    summary { cursor: pointer; font-weight: 700; transition: color .2s; }
    summary:hover { color: var(--brand); }
    
    /* SVG theming */
    .node { cursor: pointer; }
    .node-label { font-size: 12px; fill: var(--ink); text-anchor: middle; dominant-baseline: middle; pointer-events: none; font-weight: 500; }
    .node-rect {
      fill: var(--bg-card);
      stroke: var(--brand);
      stroke-opacity: 0.6;
      stroke-width: 1.2;
      rx: 8; ry: 8;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,.1));
      transition: stroke .2s, stroke-width .2s, fill .2s;
    }
    .edge-line { stroke: var(--border); stroke-width: 1.2; }
    .node:hover .node-rect { stroke: var(--brand); stroke-opacity: 1; stroke-width: 2; }
    .badge { font-size: 11px; fill: var(--ink-muted); }
    .node.hl .node-rect { stroke: var(--highlight-stroke); stroke-width: 2.5; fill: var(--highlight-bg); }
  </style>
</head>
<body>
  <header class="wrap">
    <div class="bar">
      <div class="brand">ì‹ ê¸°í•œ ìœ ë¦¬ìˆ˜ ë‚˜ë¬´ <small>AIêµìœ¡ì—°êµ¬íšŒ : ìœ„ë“œì„</small></div>
      <div class="hint">SVG ì €ì¥ Â· í™”ë©´ ìë™ ë§ì¶¤</div>
    </div>
  </header>

  <main class="wrap" style="padding-top:0;">
    <section class="card ctrls" id="ctrls">
      <div class="g1 ctrls-group">
        <label class="inline"><input type="radio" name="treeType" value="cw" checked> ì¹¼í‚¨-ìœŒí”„</label>
        <label class="inline"><input type="radio" name="treeType" value="sb"> ìŠ¤í„´-ë¸Œë¡œì½§</label>
        <span style="width:1px; height:20px; background:var(--border); margin:0 8px;"></span>
        <label class="inline">ê¹Šì´ <select id="depthSel">
          <option>1</option><option>2</option><option>3</option>
          <option selected>4</option><option>5</option><option>6</option><option>7</option><option>8</option>
        </select></label>
        <label class="inline">ë…¸ë“œ í­ <input id="nodeW" type="number" value="60" min="40" max="110" step="2"></label>
        <label class="inline">ë…¸ë“œ ë†’ì´ <input id="nodeH" type="number" value="28" min="22" max="70" step="2"></label>
        <button class="btn" id="btnRedraw">ë‹¤ì‹œ ê·¸ë¦¬ê¸°</button>
        <button class="btn" id="btnFit">í™”ë©´ ë§ì¶¤</button>
        <button class="btn" id="btnSave">SVG ì €ì¥</button>
      </div>
      <div class="g2 ctrls-group">
        <label class="inline">ë¶„ìˆ˜ ê²€ìƒ‰ <input id="findFrac" type="text" placeholder="ì˜ˆ: 2/5" style="min-width:100px"></label>
        <button class="btn primary" id="btnFind">ì°¾ê¸°</button>
      </div>
    </section>
    
    <div class="card muted" style="margin-top:var(--gap); font-size:0.9rem; line-height:1.6;">
        <b>ì¹¼í‚¨-ìœŒí”„(Calkin-Wilf) ë‚˜ë¬´:</b> ë¶€ëª¨(<code>a/b</code>)ê°€ ìì‹(<code>a/(a+b)</code> ì™€ <code>(a+b)/b</code>)ì„ ë‚³ëŠ” ê°„ë‹¨í•œ ê·œì¹™ìœ¼ë¡œ ë§Œë“¤ì–´ì ¸ìš”. <br><b>ìŠ¤í„´-ë¸Œë¡œì½§(Stern-Brocot) ë‚˜ë¬´:</b> ë‘ ë¶„ìˆ˜ ì‚¬ì´ì— ìƒˆë¡œìš´ ë¶„ìˆ˜ë¥¼ ë¼ì›Œ ë„£ëŠ” ë°©ì‹ìœ¼ë¡œ ìë¼ë‚˜ìš”. ë‘ ë‚˜ë¬´ ëª¨ë‘ ëª¨ë“  ì–‘ì˜ ìœ ë¦¬ìˆ˜ë¥¼ ë”± í•œ ë²ˆì”©ë§Œ í’ˆê³  ìˆëŠ” ì•„ì£¼ íŠ¹ë³„í•œ ë‚˜ë¬´ëë‹ˆë‹¤!
    </div>

    <section class="host" id="host">
      <svg id="treeSVG" viewBox="0 0 1200 680" preserveAspectRatio="xMidYMin meet" style="width:100%;height:100%;display:block"></svg>
    </section>

    <section class="panel">
      <article class="card">
        <h2 style="margin-bottom:12px">ìì—°ìˆ˜ì™€ ë¶„ìˆ˜ì˜ 1:1 ì•”í˜¸ êµí™˜ ğŸ¤</h2>
        <p class="muted" style="margin-bottom:16px; font-size:0.95rem;">ëª¨ë“  ìì—°ìˆ˜ëŠ” ìì‹ ë§Œì˜ ì§ê¿ ë¶„ìˆ˜ë¥¼, ëª¨ë“  ë¶„ìˆ˜ëŠ” ìì‹ ë§Œì˜ ì§ê¿ ìì—°ìˆ˜ë¥¼ ê°–ê³  ìˆì–´ìš”. ì´ ë‚˜ë¬´ëŠ” ê·¸ ë¹„ë°€ìŠ¤ëŸ¬ìš´ ì§ì„ ì°¾ì•„ì¤€ë‹µë‹ˆë‹¤. ë‚˜ë¬´ì˜ ë…¸ë“œë¥¼ ì§ì ‘ í´ë¦­í•´ì„œ ê²½ë¡œë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!</p>
        <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:12px">
          <label class="inline">ìì—°ìˆ˜ n <input id="nInput" type="number" value="1" min="1" step="1" style="width:110px"></label>
          <button class="btn" id="btnN2Q">â†’ ë¶„ìˆ˜ë¡œ</button>
          <label class="inline">ë¶„ìˆ˜ a/b <input id="abInput" type="text" value="1/1" style="width:110px"></label>
          <button class="btn" id="btnQ2N">â†’ ìì—°ìˆ˜ë¡œ</button>
        </div>
        <div id="mapOut" class="muted" style="line-height:1.6; padding:10px; border-radius:8px; background:var(--bg); min-height:48px; transition: background-color .3s;">
          ì´ê³³ì— ìì—°ìˆ˜-ë¶„ìˆ˜ ë³€í™˜ ê²°ê³¼ì™€ ê²½ë¡œê°€ í‘œì‹œë©ë‹ˆë‹¤.
        </div>
        <p class="hint" style="margin-top:12px">
          <b>ì•”í˜¸ ê·œì¹™:</b> ìì—°ìˆ˜ë¥¼ 2ì§„ìˆ˜ë¡œ ë°”ê¿”ìš”. ë§¨ ì• '1'ì€ ì¶œë°œ ì‹ í˜¸! ê·¸ ë’¤ë¶€í„° <span class="kbd">0</span>ì€ ì™¼ìª½, <span class="kbd">1</span>ì€ ì˜¤ë¥¸ìª½ ê¸¸ë¡œ ë”°ë¼ê°€ë©´... ì§ ! ì§ê¿ ë¶„ìˆ˜ê°€ ê¸°ë‹¤ë¦¬ê³  ìˆë‹µë‹ˆë‹¤.
        </p>
      </article>

      <article class="card">
        <h2 style="margin-bottom:12px">ìœ ë¦¬ìˆ˜ ì¤„ ì„¸ìš°ê¸° ğŸ”¢</h2>
        <div style="display:flex; gap:10px; align-items:center; margin-bottom:16px">
          <label class="inline">ê°œìˆ˜ N <input id="listN" type="number" value="32" min="1" max="2048" step="1" style="width:100px"></label>
          <button class="btn" id="btnList">ëª©ë¡ ìƒì„±</button>
        </div>
        <div class="scroll">
          <table class="tbl" id="listTbl">
            <thead><tr><th style="width:80px">ë²ˆí˜¸(n)</th><th style="width:120px">ë¶„ìˆ˜(a/b)</th><th>ì†Œìˆ˜(â‰ˆ)</th><th>ê²½ë¡œ</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </article>

      <article class="card full">
        <details open>
          <summary>ğŸ¤” ìœ ë¦¬ìˆ˜ëŠ” ì™œ "ì…€ ìˆ˜ ìˆë‹¤"ê³  ë§í• ê¹Œìš”? (ê°€ì‚° ì´ì•¼ê¸°)</summary>
          <div style="margin-top:12px; line-height:1.75; padding-left:8px;">
            <ol style="margin:0; padding-left:20px;">
              <li><b>ë¹ ì§ì—†ì´, ê²¹ì¹˜ì§€ ì•Šê²Œ!</b><br>ì´ ë‚˜ë¬´ì—ëŠ” ì„¸ìƒì˜ ëª¨ë“  ì–‘ì˜ ë¶„ìˆ˜(ì–‘ì˜ ìœ ë¦¬ìˆ˜)ê°€ **ë¹ ì§ì—†ì´ ë”± í•œ ë²ˆì”©ë§Œ** ë‚˜íƒ€ë‚˜ìš”. ë§ˆì¹˜ ìš°ë¦¬ ë°˜ ì¹œêµ¬ë“¤ì´ í•œ ëª…ë„ ë¹ ì§ì—†ì´, í•œ ì¤„ë¡œ ì„œ ìˆëŠ” ê²ƒê³¼ ê°™ì•„ìš”.</li>
              <li><b>ëª¨ë“  ë¶„ìˆ˜ì— ë²ˆí˜¸ ë¶™ì´ê¸°!</b><br>ë‚˜ë¬´ì˜ ëª¨ë“  ë¶„ìˆ˜ëŠ” ê¼­ëŒ€ê¸°(1/1)ì—ì„œë¶€í„° ë‚´ë ¤ì˜¤ëŠ” **ìì‹ ë§Œì˜ ê³ ìœ í•œ ê¸¸(ê²½ë¡œ)**ì„ ê°€ì ¸ìš”. ì´ ê¸¸ì„ 'ì™¼ìª½ì€ 0, ì˜¤ë¥¸ìª½ì€ 1'ì²˜ëŸ¼ ì•”í˜¸ë¡œ ë°”ê¿€ ìˆ˜ ìˆì£ . ì´ ì•”í˜¸ ë•ë¶„ì— ìš°ë¦¬ëŠ” ëª¨ë“  ë¶„ìˆ˜ì— '1ë²ˆ ë¶„ìˆ˜', '2ë²ˆ ë¶„ìˆ˜', '3ë²ˆ ë¶„ìˆ˜'... ì²˜ëŸ¼ ìì—°ìˆ˜ ë²ˆí˜¸ë¥¼ ëì—†ì´ ë¶™ì—¬ì¤„ ìˆ˜ ìˆë‹µë‹ˆë‹¤.</li>
              <li><b>'ì…€ ìˆ˜ ìˆëŠ” ë¬´í•œ'ì˜ ì˜ë¯¸</b><br>ìì—°ìˆ˜ì²˜ëŸ¼ ë²ˆí˜¸ë¥¼ í•˜ë‚˜ì”© ë¶™ì—¬ì„œ ì…€ ìˆ˜ ìˆëŠ” ë¬´í•œì„ ìˆ˜í•™ì—ì„œëŠ” **'ê°€ì‚° ë¬´í•œ(Countable Infinity)'**ì´ë¼ê³  ë¶ˆëŸ¬ìš”. ê·¸ë˜ì„œ ìœ ë¦¬ìˆ˜ëŠ” ì…€ ìˆ˜ ìˆëŠ” ë¬´í•œì§‘í•©ì´ì—ìš”. ë¬´í•œíˆ ë§ê¸´ í•˜ì§€ë§Œ, ìì—°ìˆ˜ì™€ 'ê°™ì€ ê¸‰'ì˜ ë¬´í•œì¸ ì…ˆì´ì£ !</li>
            </ol>
          </div>
        </details>
      </article>
    </section>
  </main>

  <footer class="wrap" style="padding-bottom:2rem;">
    <div class="bar" style="justify-content:center; gap:20px; flex-wrap:wrap; box-shadow:none; background:transparent; border:none; font-size:0.9rem; color:var(--ink-muted);">
      <div>â“’ 2025 AIêµìœ¡ì—°êµ¬íšŒ withseok. All rights reserved. (ìœ„ë“œì„)</div>
      <div style="display:flex; gap:20px;">
        <a href="https://withseok.tistory.com/606" target="_blank" rel="noopener" style="color:inherit;">ìœ„ë“œì„</a>
        <a href="https://aiers.kr" target="_blank" rel="noopener" style="color:inherit;">AIêµìœ¡ì—°êµ¬íšŒ</a>
      </div>
    </div>
  </footer>

  <script>
  (function(){
    'use strict';

    // ---------- ê³µí†µ ìœ í‹¸ ----------
    const $ = (sel, root=document)=>root.querySelector(sel);
    const $$ = (sel, root=document)=>[...root.querySelectorAll(sel)];
    const gcd = (a,b)=>{ a=Math.abs(a); b=Math.abs(b); while(b){ [a,b]=[b, a%b] } return a||1; };
    const simp = (n,d)=>{ const g=gcd(n,d); return [n/g, d/g]; };
    const mediant = (a,b,c,d)=>[a+c, b+d];

    function parseFrac(txt){
      if(!txt) return null;
      const s = String(txt).trim();
      const m = s.match(/^(-?\d+)\s*\/\s*(-?\d+)$/);
      if(!m) return null;
      let a = parseInt(m[1],10), b = parseInt(m[2],10);
      if(b===0) return null;
      const sign = (b<0 ? -1 : 1);
      a *= sign; b *= sign;
      const [nn,dd] = simp(a,b);
      return [nn,dd];
    }

    // ---------- íŠ¸ë¦¬ ìƒì„± ----------
    function genCW(depth){
      const lvls=[]; let id=0;
      const root = {id:id++, n:1, d:1, depth:0, pid:null};
      lvls.push([root]);
      for(let lv=0; lv<depth; lv++){
        const cur = lvls[lv], nxt=[];
        for(const p of cur){
          const a=p.n,b=p.d;
          nxt.push({id:id++, n:a,   d:a+b, depth:lv+1, pid:p.id});
          nxt.push({id:id++, n:a+b, d:b,   depth:lv+1, pid:p.id});
        }
        lvls.push(nxt);
      }
      return lvls;
    }
    function genSB(depth){
      const lvls=[]; let id=0;
      const root = {id:id++, n:1,d:1, depth:0, pid:null, La:0,Lb:1, Ra:1,Rb:0};
      lvls.push([root]);
      for(let lv=0; lv<depth; lv++){
        const cur=lvls[lv], nxt=[];
        for(const p of cur){
          const [ln,ld]=mediant(p.La,p.Lb,p.n,p.d);
          const [rn,rd]=mediant(p.n,p.d,p.Ra,p.Rb);
          let L={id:id++, n:ln,d:ld, depth:lv+1, pid:p.id, La:p.La,Lb:p.Lb, Ra:p.n,Rb:p.d};
          let R={id:id++, n:rn,d:rd, depth:lv+1, pid:p.id, La:p.n,Lb:p.d, Ra:p.Ra,Rb:p.Rb};
          [L.n,L.d]=simp(L.n,L.d); [R.n,R.d]=simp(R.n,R.d);
          nxt.push(L,R);
        }
        lvls.push(nxt);
      }
      return lvls;
    }

    // ---------- ë Œë” ----------
    const host = $('#host');
    const svg  = $('#treeSVG');
    let NODE_W = 60, NODE_H = 28;

    function render(levels){
      const L = levels.length;
      const width  = host.clientWidth || 1200;
      // -- ì„¸ë¡œ ê°„ê²© ì¡°ì • --
      const layerGap = Math.max(20, NODE_H * 1.4);
      const height = 30 + L*NODE_H + (L-1)*layerGap;

      svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
      svg.innerHTML = '';

      const id2pt = new Map();
      for(let lv=0; lv<L; lv++){
        const row = levels[lv], n=row.length;
        const usable = width - 2 * NODE_W; // ì–‘ìª½ ì—¬ë°±
        const y = 15 + NODE_H/2 + lv*(layerGap+NODE_H);
        for(let i=0;i<n;i++){
          const x = NODE_W + (n > 1 ? i * (usable / (n - 1)) : usable / 2);
          id2pt.set(row[i].id, {x,y});
        }
      }

      const edgesFrag = document.createDocumentFragment();
      for(let lv=1; lv<L; lv++){
        for(const node of levels[lv]){
          const p = id2pt.get(node.pid), c = id2pt.get(node.id);
          const line = document.createElementNS('http://www.w3.org/2000/svg','line');
          line.setAttribute('x1', p.x); line.setAttribute('y1', p.y);
          line.setAttribute('x2', c.x); line.setAttribute('y2', c.y);
          line.setAttribute('class','edge-line');
          edgesFrag.appendChild(line);
        }
      }
      svg.appendChild(edgesFrag);

      const nodesFrag = document.createDocumentFragment();
      for(let lv=0; lv<L; lv++){
        for(const node of levels[lv]){
          const {x,y} = id2pt.get(node.id);
          const g = document.createElementNS('http://www.w3.org/2000/svg','g');
          g.setAttribute('class','node');
          g.setAttribute('transform', `translate(${x - NODE_W/2}, ${y - NODE_H/2})`);
          g.dataset.frac = `${node.n}/${node.d}`;
          
          // -- í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ --
          g.addEventListener('click', () => showPathForNode(node.n, node.d));

          const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
          rect.setAttribute('width', NODE_W); rect.setAttribute('height', NODE_H);
          rect.setAttribute('class','node-rect');

          const label = document.createElementNS('http://www.w3.org/2000/svg','text');
          label.setAttribute('x', NODE_W/2); label.setAttribute('y', NODE_H/2 + 1);
          label.setAttribute('class','node-label');
          label.textContent = `${node.n}/${node.d}`;

          const title = document.createElementNS('http://www.w3.org/2000/svg','title');
          title.textContent = `ë¶„ìˆ˜: ${node.n}/${node.d} (ê¹Šì´ ${node.depth})\ní´ë¦­í•´ì„œ ê²½ë¡œ í™•ì¸!`;
          
          g.append(rect, label, title);
          nodesFrag.appendChild(g);
        }
      }
      svg.appendChild(nodesFrag);
      
      const badge = document.createElementNS('http://www.w3.org/2000/svg','text');
      badge.setAttribute('x', width-12); badge.setAttribute('y', height-12);
      badge.setAttribute('text-anchor','end'); badge.setAttribute('class','badge');
      badge.textContent = 'AIêµìœ¡ì—°êµ¬íšŒ : ìœ„ë“œì„';
      svg.appendChild(badge);
    }

    // ---------- ì»¨íŠ¸ë¡¤Â·ìƒíƒœ ----------
    const depthSel = $('#depthSel');
    const nodeW = $('#nodeW'); const nodeH = $('#nodeH');
    const btnRedraw = $('#btnRedraw'); const btnFit = $('#btnFit'); const btnSave = $('#btnSave');

    function currentType(){ return $$('input[name="treeType"]').find(r=>r.checked)?.value || 'cw' }
    function buildLevels(){
      const d = parseInt(depthSel.value,10);
      return currentType()==='cw' ? genCW(d) : genSB(d);
    }
    function redraw(){
      NODE_W = Math.max(40, Math.min(110, parseInt(nodeW.value,10)||60));
      NODE_H = Math.max(22, Math.min(70,  parseInt(nodeH.value,10)||28));
      clearHL();
      render(buildLevels());
    }

    // ---------- ê²€ìƒ‰/í•˜ì´ë¼ì´íŠ¸/ê²½ë¡œí‘œì‹œ ----------
    const findFrac = $('#findFrac'); const btnFind = $('#btnFind');
    const mapOut = $('#mapOut');

    function clearHL(){ $$('.node.hl', svg).forEach(n=>n.classList.remove('hl')); }
    function highlight(ab){
      clearHL();
      const target = $(`.node[data-frac="${ab}"]`, svg);
      if(target){
          target.classList.add('hl');
          return true;
      }
      return false;
    }
    btnFind.addEventListener('click', ()=>{
      const f = parseFrac(findFrac.value);
      if(!f){ alert('a/b í˜•íƒœë¡œ ì…ë ¥í•˜ì„¸ìš” (ë¶„ëª¨ 0 ë¶ˆê°€)'); return; }
      const ab = `${f[0]}/${f[1]}`;
      if(!highlight(ab)) alert('í˜„ì¬ ê¹Šì´ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¹Šì´ë¥¼ ëŠ˜ë ¤ë³´ì„¸ìš”.');
      else {
        showPathForNode(f[0], f[1]);
      }
    });

    function showPathForNode(a,b) {
      if(currentType() !== 'cw') {
        mapOut.innerHTML = `ê²½ë¡œ ì¶”ì ì€ <b>ì¹¼í‚¨-ìœŒí”„ íŠ¸ë¦¬</b>ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.`;
        highlight(`${a}/${b}`);
        return;
      }
      const pathArr = getFracPath(a,b);
      const pathStr = pathArr.map(d => d==='L' ? '<b>ì™¼ìª½</b>' : '<b>ì˜¤ë¥¸ìª½</b>').join(' â†’ ');
      mapOut.innerHTML = `<b>${a}/${b}</b> íƒìƒ‰ ê²½ë¡œ:<br>ë£¨íŠ¸(1/1)ì—ì„œ ${pathStr || '<b>ë„ì°©!</b>'} ìˆœì„œë¡œ ì´ë™í–ˆì–´ìš”.`;
      highlight(`${a}/${b}`);
      mapOut.style.backgroundColor = 'var(--brand-light)';
      setTimeout(() => { mapOut.style.backgroundColor = 'var(--bg)'; }, 1500);
    }

    // ---------- â„• â†” â„šâº (Calkinâ€“Wilf ê²½ë¡œ 2ì§„ìˆ˜) ----------
    function nToFrac(n){
      let a=1, b=1;
      const bits = n.toString(2).slice(1);
      for(const bit of bits){
        if(bit==='0'){ b = a + b; } else{ a = a + b; }
      }
      return [a,b];
    }
    function fracToN(a,b){
      [a,b] = simp(a,b);
      if(a<=0 || b<=0) return null;
      const path=[];
      while(!(a===1 && b===1)){
        if(a>b){ a -= b; path.push('1'); }
        else   { b -= a; path.push('0'); }
      }
      return parseInt('1' + path.reverse().join(''), 2);
    }
    function getFracPath(a,b) {
      [a,b] = simp(a,b);
      if(a<=0 || b<=0) return [];
      const path = [];
      while(!(a===1 && b===1)){
        if(a>b) { a -= b; path.push('R'); } // Right
        else { b -= a; path.push('L'); } // Left
      }
      return path.reverse();
    }

    const nInput = $('#nInput'), abInput=$('#abInput');
    const btnN2Q=$('#btnN2Q'), btnQ2N=$('#btnQ2N');

    btnN2Q.addEventListener('click', ()=>{
      const n = parseInt(nInput.value,10);
      if(!(n>=1)){ alert('nì€ 1 ì´ìƒì˜ ìì—°ìˆ˜'); return; }
      const [a,b] = nToFrac(n);
      const path = n.toString(2).slice(1).replace(/0/g,'L').replace(/1/g,'R') || '(ë£¨íŠ¸)';
      abInput.value = `${a}/${b}`;
      mapOut.innerHTML = `ìì—°ìˆ˜ <b>${n}</b> <span class="muted">(${n.toString(2)}â‚‚)</span>ì˜ ì§ê¿ ë¶„ìˆ˜ëŠ” <b>${a}/${b}</b> ì…ë‹ˆë‹¤. <br>ê²½ë¡œ: <b>${path}</b>`;
      highlight(`${a}/${b}`);
    });
    btnQ2N.addEventListener('click', ()=>{
      const f = parseFrac(abInput.value);
      if(!f){ alert('a/b í˜•íƒœë¡œ ì…ë ¥'); return; }
      const [a,b]=f;
      if(a<=0||b<=0){ alert('ì–‘ì˜ ìœ ë¦¬ìˆ˜ë§Œ (a>0, b>0)'); return; }
      const n = fracToN(a,b);
      const path = n.toString(2).slice(1).replace(/0/g,'L').replace(/1/g,'R') || '(ë£¨íŠ¸)';
      nInput.value = n;
      mapOut.innerHTML = `ë¶„ìˆ˜ <b>${a}/${b}</b>ì˜ ì§ê¿ ìì—°ìˆ˜ëŠ” <b>${n}</b> <span class="muted">(${n.toString(2)}â‚‚)</span> ì…ë‹ˆë‹¤. <br>ê²½ë¡œ: <b>${path}</b>`;
      highlight(`${a}/${b}`);
    });

    // ---------- ëª©ë¡(ì²˜ìŒ Nê°œ) ----------
    const listN = $('#listN'); const btnList = $('#btnList'); const listTbl = $('#listTbl tbody');
    function buildList(N){
      const rows = [];
      for(let n=1;n<=N;n++){
        const [a,b]=nToFrac(n);
        const path = n.toString(2).slice(1).replace(/0/g,'L').replace(/1/g,'R') || 'â€“';
        rows.push(`<tr><td>${n}</td><td>${a}/${b}</td><td>${(a/b).toFixed(6)}</td><td>${path}</td></tr>`);
      }
      listTbl.innerHTML = rows.join('');
    }
    btnList.addEventListener('click', ()=>{
      const N = Math.min(2048, Math.max(1, parseInt(listN.value,10)||32));
      buildList(N);
    });
    buildList(parseInt(listN.value,10));

    // ---------- ì €ì¥/í™”ë©´ë§ì¶¤/ì´ë²¤íŠ¸ ----------
    function saveSVG(){
        const svgEl = svg.cloneNode(true);
        const styleEl = document.createElement('style');
        styleEl.textContent = Array.from(document.styleSheets)
            .map(s => { try { return Array.from(s.cssRules).map(r => r.cssText).join('\n'); } catch { return ''; } })
            .join('\n');
        svgEl.insertBefore(styleEl, svgEl.firstChild);
        
        const src = new XMLSerializer().serializeToString(svgEl);
        const blob = new Blob(['<?xml version="1.0" standalone="no"?>\r\n', src], {type:'image/svg+xml;charset=utf-8'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'rational-tree.svg';
        a.click();
        setTimeout(() => URL.revokeObjectURL(a.href), 1000);
    }
    btnSave.addEventListener('click', saveSVG);

    function fitHeight(){
      const vh = Math.max(450, Math.min(720, Math.round(window.innerHeight * 0.64)));
      host.style.height = vh + 'px';
      redraw();
    }
    btnFit.addEventListener('click', fitHeight);

    btnRedraw.addEventListener('click', redraw);
    depthSel.addEventListener('change', redraw);
    nodeW.addEventListener('change', redraw);
    nodeH.addEventListener('change', redraw);
    $$('input[name="treeType"]').forEach(r=>r.addEventListener('change', redraw));
    
    let resizeTimer;
    window.addEventListener('resize', ()=>{
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(redraw, 150);
    });

    redraw();
  })();
  </script>
</body>
</html>